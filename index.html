<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💉 Thông tin vacxin 💉</title>
    <style>
        body {font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f7f9;}
        .container {width: 100%; max-width: 100%; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);}
        h1 {
  text-align: center;
  color: #333;
  font-size: 22px;
  margin: 5px 0 10px;
  font-weight: 600;
}
        .controls {display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap;}
        .controls .search-container {flex: 1; display: flex; gap: 10px; margin-right: 20px;}
        .search-container label {font-weight: bold; font-size: 18px; align-self: center;}
        .search-container input {flex-grow: 1; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;}
        button {padding: 10px 15px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s;}
        #add-btn {background-color: #28a745; color: white;} #add-btn:hover {background-color: #218838;}
        #export-btn {background-color: #007bff; color: white; margin-left: 10px;} #export-btn:hover {background-color: #0056b3;}
        #import-btn {background-color: #ff9800; color: white; margin-left: 10px;} #import-btn:hover {background-color: #e68900;}
        #clear-all-btn {background-color: #dc3545; color: white; margin-left: 10px;} #clear-all-btn:hover {background-color: #c82333;}
        .table-container {overflow-x: auto;} table {width: 100%; border-collapse: collapse; text-align: left;}
        th, td {padding: 12px 15px; border: 1px solid #ddd; vertical-align: top;} th {background-color: #e9ecef; font-weight: bold; color: #495057;}
        tr:nth-child(even) {background-color: #f9f9f9;} .action-btns {display: flex; gap: 5px;}
        .edit-btn {background-color: #ffc107; color: black;} .delete-btn {background-color: #dc3545; color: white;}
        .edit-btn:hover {background-color: #e0a800;} .delete-btn:hover {background-color: #c82333;}
        .modal {display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); justify-content: center; align-items: center;}
        .modal-content {background-color: #fefefe; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); width: 90%; max-width: 500px;}
        .modal-content input {width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;}
        .modal-buttons {display: flex; justify-content: flex-end; gap: 10px;}
    </style>
</head>
<body>
<div class="container">
    <h1>💉 Thông tin vacxin 💉</h1>

<!-- 🧩 MODULE TÍNH TUỔI (PHIÊN BẢN GỌN) -->
<div id="age-calculator" style="font-family:sans-serif;display:inline-flex;align-items:center;gap:6px;margin:8px 0;">
  <label for="dob" style="white-space:nowrap;">Ngày sinh:</label>
  <input type="date" id="dob" style="padding:4px 6px;border-radius:4px;border:1px solid #bbb;font-size:14px;">
  <span id="result" style="font-weight:600;color:#222;margin-left:6px;">–</span>
</div>

<script>
document.getElementById("dob").addEventListener("change", function() {
  const dob = new Date(this.value);
  const result = document.getElementById("result");
  if (isNaN(dob)) return result.textContent = "–";

  const today = new Date();
  let years = today.getFullYear() - dob.getFullYear();
  let months = today.getMonth() - dob.getMonth();
  let days = today.getDate() - dob.getDate();

  if (days < 0) {
    months--;
    const prevMonth = new Date(today.getFullYear(), today.getMonth(), 0);
    days += prevMonth.getDate();
  }
  if (months < 0) {
    years--;
    months += 12;
  }

  const totalDays = Math.floor((today - dob) / (1000 * 60 * 60 * 24));
  result.textContent = `${years} năm ${months} tháng ${days} ngày = ${totalDays} ngày`;
});
</script>


    <div class="controls">
        <div class="search-container">
            <label for="searchBox">Tìm kiếm:</label>
            <input type="text" id="searchBox" placeholder="Nhập từ khóa...">
        </div>
        <div>
            <button id="add-btn">Thêm mới</button>
            <button id="export-btn">Xuất Excel</button>
            <input type="file" id="import-file" accept=".csv" style="display:none;">
            <button id="import-btn">Nhập CSV</button>
            <button id="clear-all-btn">Xóa tất cả</button>
        </div>
    </div>
    <div class="table-container">
        <table id="vaccineTable">
            <thead>
                <tr>
                    <th>Nhóm Bệnh</th>
                    <th>Tên Vắc-xin</th>
                    <th>Phác đồ</th>
                    <th>Tương Tác</th>
                    <th>Min/Max</th>
                    <th>Giá lẻ</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="data-modal" class="modal">
    <div class="modal-content">
        <h2 id="modal-title">Thêm mới</h2>
        <form id="data-form">
            <input type="hidden" id="data-index">
            <label for="nhomBenh">Nhóm Bệnh:</label>
            <input type="text" id="nhomBenh" required>
            <label for="tenVaccine">Tên Vắc-xin:</label>
            <input type="text" id="tenVaccine" required>
            <label for="phacDo">Phác đồ:</label>
            <input type="text" id="phacDo" required>
            <label for="tuongTac">Tương Tác:</label>
            <input type="text" id="tuongTac">
            <label for="minMax">Min/Max:</label>
            <input type="text" id="minMax">
            <label for="giaLe">Giá lẻ:</label>
            <input type="text" id="giaLe">
            <div class="modal-buttons">
                <button type="submit">Lưu</button>
                <button type="button" id="cancel-btn">Hủy</button>
            </div>
        </form>
    </div>
</div>

<script>
const LOCAL_STORAGE_KEY = 'vaccine_data';
function loadData(){try{const stored=localStorage.getItem(LOCAL_STORAGE_KEY);return stored?JSON.parse(stored):[]}catch(e){return[];}}
function saveData(){localStorage.setItem(LOCAL_STORAGE_KEY,JSON.stringify(data));}
let data=loadData();
const searchBox=document.getElementById('searchBox'),tableBody=document.querySelector('#vaccineTable tbody'),addBtn=document.getElementById('add-btn'),exportBtn=document.getElementById('export-btn'),importBtn=document.getElementById('import-btn'),importFile=document.getElementById('import-file'),clearAllBtn=document.getElementById('clear-all-btn'),dataModal=document.getElementById('data-modal'),modalTitle=document.getElementById('modal-title'),dataForm=document.getElementById('data-form'),cancelBtn=document.getElementById('cancel-btn'),dataIndexInput=document.getElementById('data-index'),nhomBenhInput=document.getElementById('nhomBenh'),tenVaccineInput=document.getElementById('tenVaccine'),phacDoInput=document.getElementById('phacDo'),tuongTacInput=document.getElementById('tuongTac'),minMaxInput=document.getElementById('minMax'),giaLeInput=document.getElementById('giaLe');let isEditing=false;
function renderTable(f=data){tableBody.innerHTML='';if(f.length===0){tableBody.innerHTML='<tr><td colspan="7" style="text-align:center;font-style:italic;color:#888;">Không có dữ liệu nào để hiển thị.</td></tr>';return;}f.sort((a,b)=>a.nhomBenh.localeCompare(b.nhomBenh)||a.tenVaccine.localeCompare(b.tenVaccine)||a.phacDo.localeCompare(b.phacDo));let pNB=null,pTV=null;f.forEach(i=>{const r=document.createElement('tr');let nb='',tv='';const nR=f.filter(d=>d.nhomBenh===i.nhomBenh).length,tR=f.filter(d=>d.nhomBenh===i.nhomBenh&&d.tenVaccine===i.tenVaccine).length;if(i.nhomBenh!==pNB){nb=`<td rowspan="${nR}">${i.nhomBenh}</td>`;pTV=null;}if(i.tenVaccine!==pTV){tv=`<td rowspan="${tR}">${i.tenVaccine}</td>`;}const idx=data.findIndex(d=>d.nhomBenh===i.nhomBenh&&d.tenVaccine===i.tenVaccine&&d.phacDo===i.phacDo);r.innerHTML=`${nb}${tv}<td>${i.phacDo}</td><td>${i.tuongTac}</td><td>${i.minMax}</td><td>${i.giaLe}</td><td class="action-btns"><button class="edit-btn" data-index="${idx}">Sửa</button><button class="delete-btn" data-index="${idx}">Xóa</button></td>`;tableBody.appendChild(r);pNB=i.nhomBenh;pTV=i.tenVaccine;});}
function handleSearch(){const s=searchBox.value.toLowerCase().trim();renderTable(data.filter(i=>Object.values(i).some(v=>String(v).toLowerCase().includes(s))));}
function openAddModal(){modalTitle.textContent='Thêm mới';dataForm.reset();dataIndexInput.value='';isEditing=false;dataModal.style.display='flex';}
function openEditModal(i){modalTitle.textContent='Chỉnh sửa';const it=data[i];dataIndexInput.value=i;nhomBenhInput.value=it.nhomBenh;tenVaccineInput.value=it.tenVaccine;phacDoInput.value=it.phacDo;tuongTacInput.value=it.tuongTac;minMaxInput.value=it.minMax;giaLeInput.value=it.giaLe;isEditing=true;dataModal.style.display='flex';}
function handleFormSubmit(e){e.preventDefault();const n={nhomBenh:nhomBenhInput.value,tenVaccine:tenVaccineInput.value,phacDo:phacDoInput.value,tuongTac:tuongTacInput.value,minMax:minMaxInput.value,giaLe:giaLeInput.value};if(isEditing){data[dataIndexInput.value]=n;}else{data.push(n);}dataModal.style.display='none';saveData();renderTable();}
function handleDelete(i){if(confirm('Xóa dòng này?')){data.splice(i,1);saveData();renderTable();}}
function handleClearAll(){if(confirm('Xóa tất cả dữ liệu?')){data=[];saveData();renderTable();alert('Đã xóa tất cả dữ liệu.');}}
function exportToExcel(){const h=["Nhóm Bệnh","Tên Vắc-xin","Phác đồ","Tương Tác","Min/Max","Giá lẻ"],c=[h.map(x=>`"${x.replace(/"/g,'""')}"`).join(',')];data.forEach(i=>{c.push([i.nhomBenh,i.tenVaccine,i.phacDo,i.tuongTac,i.minMax,i.giaLe].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(','));});const blob=new Blob(["\uFEFF",c.join('\n')],{type:'text/csv;charset=utf-8;'}),link=document.createElement('a');link.href=URL.createObjectURL(blob);const d=new Date(),day=String(d.getDate()).padStart(2,'0'),month=String(d.getMonth()+1).padStart(2,'0'),year=d.getFullYear();link.download=`dulieumau_${day}_${month}_${year}.csv`;link.click();}
function parseCsv(t){const l=t.trim().split('\n'),h=l[0].split(',').map(x=>x.trim().replace(/"/g,'')),r=[],re=/"([^"]*)"|[^,]+/g;for(let i=1;i<l.length;i++){const line=l[i],f=[];let m;while((m=re.exec(line))!==null){f.push(m[1]||m[0]);}if(f.length!==h.length)continue;const o={};for(let j=0;j<h.length;j++){o[h[j]]=f[j]?f[j].trim().replace(/"/g,''):'';}r.push(o);}return r;}
function importFromCsv(f){const rd=new FileReader();rd.onload=e=>{const imp=parseCsv(e.target.result).map(r=>({nhomBenh:r["Nhóm Bệnh"]||'',tenVaccine:r["Tên Vắc-xin"]||'',phacDo:r["Phác đồ"]||'',tuongTac:r["Tương Tác"]||'',minMax:r["Min/Max"]||'',giaLe:r["Giá lẻ"]||''}));data.push(...imp);saveData();renderTable();alert(`Đã nhập ${imp.length} mục!`);};rd.readAsText(f,'UTF-8');}
searchBox.addEventListener('input',handleSearch);addBtn.addEventListener('click',openAddModal);tableBody.addEventListener('click',e=>{const t=e.target;if(t.classList.contains('edit-btn'))openEditModal(t.dataset.index);else if(t.classList.contains('delete-btn'))handleDelete(t.dataset.index);});dataForm.addEventListener('submit',handleFormSubmit);cancelBtn.addEventListener('click',()=>dataModal.style.display='none');window.addEventListener('click',e=>{if(e.target===dataModal)dataModal.style.display='none';});exportBtn.addEventListener('click',exportToExcel);clearAllBtn.addEventListener('click',handleClearAll);importBtn.addEventListener('click',()=>importFile.click());importFile.addEventListener('change',e=>{if(e.target.files[0])importFromCsv(e.target.files[0]);});document.addEventListener('DOMContentLoaded',()=>renderTable());
</script>
</body>
</html>